<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Add Ingredients</title>
    <style>
        .left-align,
        .mb-space {
            text-align: left;
            border: 2px solid black;
            padding: 5px;
        }

        .mb-space {
            margin-bottom: 2rem;
        }

        .alternate-bg-gray {
            background-color: #f0f0f0;
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <script src="https://tildesites.bowdoin.edu/~k.preslermarshall/AngularJS/angular.min.js"></script>
        <script>
            var app = angular.module('myApp', []);
            app.controller('populateCtrl', function ($scope, $http) {
                // in order to store the ingredients
                $scope.ingredients = []; 
                $scope.newIngredient = {};
                // so you can display diff things 
                $scope.addIngredientMessage = ''; 

                // loading whatever ingredients we alr have

                //I don't think this is right because our inventory won't return very nicely?
                $scope.getIngredients = function () {
                    $http.get("/api/v1/inventory").then(function (response) {
                        $scope.ingredients = response.data;
                    }, function (e) {
                        console.error("Could not get ingredients:", e);
                    });
                };

                // this is the function that adds an ingredient
                $scope.addIngredient = function () {

                    //this is making sure that it is even there so no need for unnecessary post req
                     if (!$scope.newIngredient.name) {
                        // Handle error for blank ingredient name
                        $scope.addIngredientMessage = 'Ingredient name is blank';
                        return;
                    }
                 
                    // you r doing post so you can validate it before you display it 
                    // will the json be formatted correctly when it's sending it here ?
                    $http.post("/api/v1/inventory", $scope.newIngredient).then(
                        function (response) {
                            // this means it was successfully added
                            $scope.ingredients.push({
                                name: $scope.newIngredient.name,
                                quantity: $scope.newIngredient.quantity || ''
                            });
                            // you have to reset it 
                            $scope.newIngredient = {}; 
                            // $scope.addIngredientError = false;
                            $scope.addIngredientMessage = 'Ingredient added successfully';
                        }, function (e) {
                            console.error("Error while adding ingredient", e);
                            // $scope.addIngredientError = true; 
                            $scope.addIngredientMessage = 'There was an error when adding the ingredient'; 
                        });
                    
                };

                //this is getting the ingredients 
                $scope.getIngredients();
            });
        </script>
        <div ng-app="myApp" ng-controller="populateCtrl">
            <div class="row justify-content-between mt-3">
                <div class="col-4">
                    <button type="button" class="btn btn-light btn-outline-dark p-3 m-1 mx-5">&lt; Cancel</button>
                </div>
                <div class="col-auto">
                    <h1>Add Ingredients</h1>
                </div>
                <div class="col-4"></div>
            </div>
            
            <div class="container mt-5">
                <h2>Current Ingredients:</h2>
                <div class="container border">
                    <div style="height: 200px; overflow-y: scroll;">
                        <ul class="list-group">
                            <li class="list-group-item" ng-repeat="ingredient in ingredients"
                                ng-class="{'alternate-bg-gray': $index % 2 === 0}">
                                {{ ingredient.name }}
                            </li>
                        </ul>
            
                    </div>
                </div>
            
                <div class="d-flex justify-content-center mt-5">
                    <div class="col-md-6">
                        <form ng-submit="addIngredient()">
                            <div class="mb-3">
                                <label for="ingredientName" class="form-label">Name*:</label>
                                <input type="text" class="form-control" id="ingredientName" ng-model="newIngredient.name"
                                    placeholder="field required">
                            </div>
                            <div class="mb-3">
                                <label for="ingredientQuantity" class="form-label">Quantity (Optional):</label>
                                <input type="text" class="form-control" id="ingredientQuantity" ng-model="newIngredient.quantity">
                            </div>
                            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                                <button class="btn btn-primary" type="submit">+ Add New Ingredient</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            </div>
            <!-- could not figure this part out yet -->
            <!-- <div class="container mt-3">
                <div ng-show="addIngredientMessage.length" class="alert"
                    ng-class="{'alert-success': addIngredientMessage.includes('successfully'), 'alert-danger': addIngredientMessage.includes('Error') || addIngredientMessage.includes('blank')}">
                    {{ addIngredientMessage }}
                </div>
            </div> -->


        </div>
       
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>